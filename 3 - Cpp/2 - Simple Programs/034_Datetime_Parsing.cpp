#include <iostream>
#include <ctime>
#include <chrono>
#include <iomanip>
#include <sstream>

// Function to get the current system time as a string
std::string getCurrentTimeAsString() {
    // Get the current time as a system clock time_point
    std::chrono::system_clock::time_point now = std::chrono::system_clock::now();

    // Convert the time_point to a time_t object
    std::time_t time = std::chrono::system_clock::to_time_t(now);

    // Convert the time_t to a local time string
    std::string timeString = std::ctime(&time);

    // Remove the newline character at the end of the string
    timeString.pop_back();

    return timeString;
}

// Function to parse a string containing a date in the format "YYYY-MM-DD" to a std::tm struct
std::tm parseDateString(const std::string& dateString) {
    std::tm timeStruct = {};
    std::istringstream ss(dateString);
    ss >> std::get_time(&timeStruct, "%Y-%m-%d");
    return timeStruct;
}

// Function to calculate the difference between two dates in days
int calculateDateDifferenceInDays(const std::string& date1, const std::string& date2) {
    std::tm timeStruct1 = parseDateString(date1);
    std::tm timeStruct2 = parseDateString(date2);

    std::time_t time1 = std::mktime(&timeStruct1);
    std::time_t time2 = std::mktime(&timeStruct2);

    const int secondsPerDay = 24 * 60 * 60;
    int differenceInDays = std::difftime(time2, time1) / secondsPerDay;

    return differenceInDays;
}

int main() {
    // Get the current system time and print it
    std::string currentTime = getCurrentTimeAsString();
    std::cout << "Current system time: " << currentTime << std::endl;

    // Parse a date string and print its components
    std::string dateString = "2023-07-31";
    std::tm parsedDate = parseDateString(dateString);
    std::cout << "Parsed date: " << std::put_time(&parsedDate, "%Y-%m-%d") << std::endl;

    // Calculate the difference between two dates
    std::string date1 = "2023-07-25";
    std::string date2 = "2023-07-31";
    int differenceInDays = calculateDateDifferenceInDays(date1, date2);
    std::cout << "Difference between " << date1 << " and " << date2 << " is " << differenceInDays << " days." << std::endl;

    return 0;
}
