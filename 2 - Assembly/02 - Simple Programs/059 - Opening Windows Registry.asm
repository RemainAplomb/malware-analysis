; MASM Example - Opening Windows Registry
; includes
include \masm32\include\masm32rt.inc

.386
.model flat, stdcall
option casemap :none
include \masm32\include\windows.inc
include \masm32\include\kernel32.inc
include \masm32\include\user32.inc
include \masm32\include\advapi32.inc
includelib \masm32\lib\kernel32.lib
includelib \masm32\lib\user32.lib
includelib \masm32\lib\advapi32.lib

.data
szKey db "Software\Microsoft",0
hKey dd ?
successMessage db "Successfully opened registry key.", 0
failureMessage db "Failed to open registry key.", 0
errorMessage db "Error", 0
successTitle db "Success", 0

.code
start:
; Try to open the registry key.
; Note that we are passing the address of hKey, 
; so that it receives the handle to the opened key.
invoke RegOpenKeyEx, HKEY_CURRENT_USER, addr szKey, 0, KEY_ALL_ACCESS, addr hKey

; Now, check if the operation was successful.
cmp eax, ERROR_SUCCESS
je _success ; If eax is ERROR_SUCCESS, jump to _success.

_failure:
; The operation failed. Let's print an error message and exit.
invoke MessageBox, NULL, addr failureMessage, addr errorMessage, MB_OK
jmp _exit

_success:
; The operation was successful. Let's print a success message.
invoke MessageBox, NULL, addr successMessage, addr successTitle, MB_OK

; Don't forget to close the key when you're done with it!
invoke RegCloseKey, hKey

_exit:
; Exit the process.
invoke ExitProcess, 0

end start

