; MASM Example - Find File Directory 2
; includes
include \masm32\include\masm32rt.inc

.386
.model flat, stdcall
option casemap :none

include \masm32\include\windows.inc
include \masm32\include\kernel32.inc
include \masm32\include\masm32.inc
includelib \masm32\lib\kernel32.lib
includelib \masm32\lib\masm32.lib

.data
    searchPattern db "*.txt",0 ; Looking for all txt files
    winFindData WIN32_FIND_DATA <>
    filePath db 260 dup (0) ; Maximum path length
    newline db 13, 10, 0 ; Newline characters

.code
start:
    ; Initialize the file search
    invoke FindFirstFile, addr searchPattern, addr winFindData
    cmp eax, INVALID_HANDLE_VALUE  ; Check if any file was found
    je no_files_found
    mov ebx, eax ; Save the handle

next_file:
    ; File found, print its name
    lea eax, [winFindData.cFileName]
    invoke lstrcpy, addr filePath, eax ; Copy file name to filePath
    invoke StdOut, addr filePath ; Print the file name
    invoke StdOut, addr newline ; Print a newline

    ; Continue the search
    invoke FindNextFile, ebx, addr winFindData
    test eax, eax ; Zero if no more files
    jnz next_file

no_files_found:
    ; Terminate the process
    invoke ExitProcess, 0
end start
