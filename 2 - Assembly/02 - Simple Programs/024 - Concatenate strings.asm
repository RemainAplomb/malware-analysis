; includes
include \masm32\include\masm32rt.inc

; MASM String Concatenation Example

.386
.model flat, stdcall
option casemap :none

include \masm32\include\windows.inc
include \masm32\include\masm32.inc
include \masm32\include\kernel32.inc

includelib \masm32\lib\masm32.lib
includelib \masm32\lib\kernel32.lib

.data
    str1 db 'Hello', 0      ; First string
    str2 db ', World!', 0   ; Second string
    result db 256 dup(0)    ; Buffer to hold the result of the concatenation

.code
start:
    ; Move the addresses of the strings into ESI and EDI
    lea esi, str1          ; ESI points to the first string
    lea edi, result        ; EDI points to the buffer for the result

    ; Copy the first string to the result
    call CopyString

    ; Move the address of the second string into ESI
    lea esi, str2          ; ESI points to the second string

    ; Copy the second string to the result
    call CopyString

    ; Print the result
    invoke StdOut, addr result

    ; End the program
    invoke ExitProcess, 0

; Subroutine to copy a null-terminated string from ESI to EDI
CopyString proc
    ; Loop until the null terminator is found
    repeat:
        lodsb              ; Load the next byte from [ESI] into AL and increment ESI
        stosb              ; Store the byte in AL into [EDI] and increment EDI
        test al, al        ; Test if AL is zero (end of string)
    jnz repeat            ; If it's not zero, loop again
    ret
CopyString endp

end start
