; includes
include \masm32\include\masm32rt.inc

; MASM Procedure Invocation Example

.386
.model flat, stdcall
option casemap :none

include \masm32\include\windows.inc
include \masm32\include\kernel32.inc

includelib \masm32\lib\kernel32.lib

.data
    msg db "The sum is: ", 0
    buffer db 33 dup(?), 0  ; 32 bits + null terminator

.code

start:
    ; Let's use two simple numbers for demonstration
    mov eax, 5
    mov ebx, 7

    ; Push the values onto the stack
    push ebx
    push eax

    ; Call the addNumbers procedure
    call addNumbers

    ; Clean up the stack
    add esp, 8

    ; The result is in EAX
    push eax
    push offset buffer
    call dwordToString
    add esp, 8  ; Clean up the stack

    ; Print the result
    push offset buffer
    push offset msg
    call print
    add esp, 8  ; Clean up the stack

    invoke ExitProcess, 0

addNumbers PROC val1:DWORD, val2:DWORD
    ; Add the two values
    mov eax, val1
    add eax, val2
    ret
addNumbers ENDP

dwordToString PROC val:DWORD, buffer:DWORD
    pusha
    mov eax, val
    mov edi, buffer
    add edi, 32
    mov byte ptr [edi], 0
    sub edi, 1

nextDigit:
    xor edx, edx
    mov ecx, 10
    div ecx
    add edx, '0'
    mov byte ptr [edi], dl
    sub edi, 1
    test eax, eax
    jnz nextDigit

    lea eax, [edi + 1]
    popa
    ret
dwordToString ENDP

print PROC msg:DWORD, val:DWORD
    push 0
    push val
    push msg
    push 0
    call MessageBoxA
    ret
print ENDP

end start
