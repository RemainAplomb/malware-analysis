; MASM Example - File Handlers

; includes
include \masm32\include\masm32rt.inc

.386
.model flat, stdcall
option casemap :none   ; case sensitive

include \masm32\include\windows.inc
include \masm32\include\kernel32.inc
includelib \masm32\lib\kernel32.lib

.data
    fileName db "testfile.txt", 0  ; File to be created
    content db "Hello, world!", 0  ; Content to write to the file
    hFile dd ?                     ; Handle for the file
    bytesWritten dd ?              ; Number of bytes written to the file

.code
start:
    ; Create the file
    ; If the file already exists, the function overwrites the file and clears all existing attributes
    invoke CreateFile, addr fileName, GENERIC_WRITE, 0, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL
    mov hFile, eax

    ; Check if the file handle is valid
    cmp eax, INVALID_HANDLE_VALUE
    jne writeToFile
    jmp endProgram

writeToFile:
    ; Write content to the file
    invoke WriteFile, hFile, addr content, sizeof content - 1, addr bytesWritten, NULL

    ; Close the file handle
    invoke CloseHandle, hFile

endProgram:
    ; Terminate the process
    invoke ExitProcess, 0
end start
