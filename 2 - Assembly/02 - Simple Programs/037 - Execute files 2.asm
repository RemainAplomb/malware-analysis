; includes
include \masm32\include\masm32rt.inc

; MASM Example - Execute a Program

.386
.model flat, stdcall
option casemap :none

include \masm32\include\windows.inc
include \masm32\include\kernel32.inc
includelib \masm32\lib\kernel32.lib

.data
    ProcessInfo PROCESS_INFORMATION <>
    StartupInfo STARTUPINFO <>
    FileName db "C:\\Windows\\System32\\notepad.exe", 0 

.code

main PROC
    ; Prepare the STARTUPINFO structure
    mov StartupInfo.cb, sizeof STARTUPINFO

    ; Create the process
    ; BOOL CreateProcess(
    ;   LPCTSTR lpApplicationName,
    ;   LPTSTR lpCommandLine,
    ;   LPSECURITY_ATTRIBUTES lpProcessAttributes,
    ;   LPSECURITY_ATTRIBUTES lpThreadAttributes,
    ;   BOOL bInheritHandles,
    ;   DWORD dwCreationFlags,
    ;   LPVOID lpEnvironment,
    ;   LPCTSTR lpCurrentDirectory,
    ;   LPSTARTUPINFO lpStartupInfo,
    ;   LPPROCESS_INFORMATION lpProcessInformation
    ; )
    push OFFSET ProcessInfo          ; lpProcessInformation
    push OFFSET StartupInfo          ; lpStartupInfo
    push 0                           ; lpCurrentDirectory
    push 0                           ; lpEnvironment
    push 0                           ; dwCreationFlags
    push 0                           ; bInheritHandles
    push 0                           ; lpThreadAttributes
    push 0                           ; lpProcessAttributes
    push OFFSET FileName             ; lpCommandLine
    push 0                           ; lpApplicationName
    call CreateProcessA

    ; Wait until the created process has finished
    push INFINITE                    ; dwMilliseconds
    push dword ptr [ProcessInfo.hProcess]  ; hHandle
    call WaitForSingleObject

    ; Terminate the program
    push 0                           ; uExitCode
    call ExitProcess
main ENDP

end main
