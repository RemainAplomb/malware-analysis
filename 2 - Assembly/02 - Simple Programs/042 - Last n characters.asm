; includes
include \masm32\include\masm32rt.inc

; MASM Example - Get Last N Characters of a String

.386
.model flat, stdcall
option casemap :none

include \masm32\include\windows.inc
include \masm32\include\kernel32.inc
includelib \masm32\lib\kernel32.lib

.data
originalString db "This is the original string.", 0
newString db 50 dup(0) ; Buffer for new string, 50 is just an arbitrary size
nCharacters equ 10 ; We want the last 10 characters

.code

main PROC
    ; Load the address of originalString into esi
    lea esi, originalString

    ; Find the length of the string
    xor ecx, ecx
    not ecx
    xor al, al
    cld
    repne scasb
    not ecx
    dec ecx ; Exclude the null-terminating character
    sub esi, ecx ; esi now points to the end of the original string
    
    ; Check if string length is less than nCharacters
    cmp ecx, nCharacters
    jge CopyCharacters

    ; If string length is less than nCharacters, just copy the whole string
    lea edi, newString
    mov ecx, nCharacters
    rep movsb
    jmp Terminate

CopyCharacters:
    ; Add the length difference to esi so it points to the start of the last n characters
    add esi, ecx
    sub esi, nCharacters

    ; Load the address of newString into edi
    lea edi, newString

    ; Move the last nCharacters from originalString to newString
    mov ecx, nCharacters
    rep movsb ; This instruction will move 'nCharacters' bytes from [esi] to [edi]

Terminate:
    ; Then we terminate the program
    push 0
    call ExitProcess
main ENDP

end main
