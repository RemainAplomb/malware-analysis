; includes
include \masm32\include\masm32rt.inc

; MASM Get Current Directory Example

.386
.model flat, stdcall
option casemap :none

include \masm32\include\windows.inc
include \masm32\include\kernel32.inc

includelib \masm32\lib\kernel32.lib

.data
    currentDirectory db 260 dup(0) ; Allocate space for the current directory path

.code

start:
    ; Get the current directory. The GetCurrentDirectory function takes two parameters:
    ; 1. The size of the buffer to hold the directory path
    ; 2. The address of the buffer
    invoke GetCurrentDirectory, sizeof currentDirectory, addr currentDirectory

    ; Print the current directory path to the console. The WriteConsole function takes five parameters:
    ; 1. A handle to the console output
    ; 2. The address of the data to be written
    ; 3. The number of characters to write
    ; 4. A pointer to a variable to receive the number of characters written
    ; 5. Reserved (must be NULL)
    push eax ; Save the number of characters in the current directory path
    invoke GetStdHandle, STD_OUTPUT_HANDLE ; Get a handle to the console output
    pop ecx ; Restore the number of characters in the current directory path
    sub ecx, 1 ; Exclude the null terminator
    invoke WriteConsole, eax, addr currentDirectory, ecx, NULL, NULL

    ; Exit the program
    invoke ExitProcess, 0
end start
