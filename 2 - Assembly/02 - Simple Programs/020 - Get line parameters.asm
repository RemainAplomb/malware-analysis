; MASM Command Line Parameters Example

.386            ; 386 processor instructions
.model flat, stdcall ; Memory model & calling convention
option casemap :none ; Case sensitive

; includes
include \masm32\include\masm32rt.inc

; Windows includes
include \masm32\include\windows.inc
include \masm32\include\kernel32.inc
includelib \masm32\lib\kernel32.lib

.data           ; Begin the data segment where variables are defined.
buffer db 256 dup(0) ; Allocate a buffer to hold the command line.

.code           ; Begin the code segment where our code is placed.

start:          ; Entry point of the program

    ; Get command line parameters
    call GetCommandLineA
    mov esi, eax  ; esi points to the command line.

    ; Skip the program name (go to the first parameter)
    next_char:
        lodsb    ; Load a byte from esi into al and increment esi.
        cmp al, 0 ; Check for end of string.
        je end_of_string
        cmp al, 32 ; Check for space (parameters are separated by spaces).
        jne next_char

    ; Copy parameters to the buffer
    lea edi, buffer ; edi points to the buffer.
    copy_chars:
        lodsb    ; Load a byte from esi into al and increment esi.
        stosb    ; Store al at edi and increment edi.
        cmp al, 0 ; Check for end of string.
        jne copy_chars

    end_of_string:

    ; Now the buffer contains the command line parameters (without the program name).

    ; End the program
    push 0     ; uExitCode
    call ExitProcess

end start       ; End of the program
