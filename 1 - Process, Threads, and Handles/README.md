# Malware Development

# Process

## Brief Description

A process is an instance of an executable. Usually, a process is not aware of
other processes outside of its existence.

Each process has its own virtual address (VA space). This space is exclusively allocated
for the process.

There are three types of processes:

    - Application processes
    - Background processes
    - Windows processes

## Executables

Executables uses processes to house and run the program. A program can have many processes running at the same time. It can also have create multiple child processes.

An example of this is when you create new tabs in your bwoser, a new process is created.

To see the processes running in your machine, you can open Task Manager.
If you are in windows you can do CTRL + Shift + ESC.

## Application process

These are running instance of a software application on a computer system.Once an application is executed, it will run as a process in the operating system. The process that is created will haveits own allocated memory space, resources, and execution context.

Here are some key points about application processes:

    - Process Creation: The operating system starts a new process to house the application you are running when you launch it. To set the process apart from other ones running on the system, a unique process identifier (PID) is given.

    - Memory Space: Each process has a dedicated memory area that houses the application-related code, data, and stack. This guarantees that processes are kept separate from one another, preventing unauthorized access or inadvertent intervention.

    - Process States: Throughout their lifespan, processes can be in a variety of states, including running, suspended and terminated. Based on variables like CPU availability and priority, the operating system controls the scheduling and execution of processes, switching them between different states.

    - Interprocess Communication: Through a variety of channels, including shared memory, pipelines, sockets, and remote procedure calls (RPC), processes can communicate with one another. Interprocess communication (IPC) enables processes to coordinate actions, share data, or work together on a project.

    - Process Termination: Usually, when an application is stopped or ends, the related process also does so. By reclaiming memory, file handles, and other system resources that were allotted to the process, the operating system releases the resources.

## Background Process

Background processes, sometimes referred to as background activities or background services, are operating system functions that are carried out in the background without direct user input or a clearly visible interface. The majority of the time, these processes carry out particular duties or offer continuing services to support the operation of the system or installed applications.

Here are some essential details about background operations:

    - Purpose: Background processes perform a variety of functions connected to the operation of the system, including system upkeep, automatic updates, network connectivity, data synchronization, monitoring, and other related activities. They are intended to run continuously or at predetermined intervals and frequently function quietly.
    - System Services: Numerous background operations are essential operating system services. These services take care of crucial tasks like monitoring network connectivity, preserving system stability, managing hardware, or taking care of user authentication.
    - Application Services: Some programs contain autonomous background processes that work in the background to carry out particular functions. For instance, a background process may be performed by antivirus software to continuously scan files and network traffic for potential dangers.
    - Resource Consumption: System resources are used up by background programs, including CPU time, memory, and disk I/O. They might be given a lower priority than foreground activities to guarantee that user-initiated actions have access to sufficient resources and responsiveness.
    - Visibility: Usually, background processes don't have windows or an obvious user interface. They function covertly, frequently operating in the background without the user's knowledge or active participation. Through system tools and task managers, they may be watched over and controlled, though.
    - Autostart: When the system boots up, several background programs are set up to run automatically. This guarantees that essential services or applications are accessible as soon as the system is turned on.

Understanding background processes is crucial in malware analysis because malware frequently impersonates a background process to run continuously on an infected system. Data exfiltration, unauthorized network communication, and other harmful operations may be carried out covertly via malicious background programs.

Analyzing background processes can make it easier to spot unauthorized or unusual activity, spot any malware infections, and remove or lessen the threat. Monitoring resource utilization, network connections, and process behavior can reveal details about background process activity and aid in separating harmful from legitimate programs.

## Windows Process

The distinct instances of executable code running on a Windows operating system are known as Windows processes. These processes represent active programs or services and are essential to the system's functionality. For tasks like keeping track of system performance, diagnosing problems, and spotting potential security concerns, understanding Windows processes is crucial.

What you need to know about Windows processes is as follows:

    - Process Identification: A unique process identifier (PID) is used by Windows to identify each process. The PID separates one process from another and enables the operating system to control and communicate with each process separately.
    - Process Hierarchy: The process tree is the hierarchical framework in which Windows processes are structured. Each process has the potential to have children, forming a parent-child relationship. This hierarchical structure makes the connections and interdependencies between processes easier to see.
    - Process Priority: Windows gives processes a priority level in order to control resource allocation. A process's priority affects how much CPU time and other system resources it gets in comparison to other processes. The operating system devotes more resources and attention to higher priority processes.
    - Process States: Windows gives processes a priority level in order to control resource allocation. A process's priority affects how much CPU time and other system resources it gets in comparison to other processes. The operating system devotes more resources and attention to higher priority processes.
    - Process Execution: A Windows process's execution context, which consists of memory, open file handles, environment variables, and other system resources, is unique to that process. The execution context guarantees that processes are kept apart from one another and provide a secure setting in which to run them.
    - Process Monitoring: is made possible by Windows and includes tools like Task Manager and PowerShell. You can view process information, resource use, CPU and memory utilization, and stop or change programs as necessary using these tools.
    - Process Security: To blend in with trusted system processes, malware frequently poses as a Windows process. It is possible to find suspicious processes that could be signs of malware activity by examining their behavior, file locations, digital signatures, and network connections.

It's crucial to distinguish between legitimate processes and possibly dangerous ones when examining Windows processes for malware investigation or system monitoring purposes. Typically, legitimate processes are signed by reputable publishers, located in well-known file locations (such as Windows system folders), and behave as expected. Unusual file locations, the absence of digital signatures, resource-intensive behavior, or suspect network activity are all characteristics of suspicious processes.

You may spot anomalies, find potential malware infections, and take the necessary steps to neutralize threats by keeping an eye on Windows processes and their activity.

# Threads

The smallest units of execution within a process are called threads. They are small, independent sets of instructions that the operating system can schedule and carry out. A single process can have several threads, each of which has its own program counter, stack, and execution context. Concurrent execution is made possible via threads, which can significantly improve a system's effectiveness and responsiveness.

The following are some essential threads points:

    - Multithreading: The capacity to run many threads concurrently within a single process is known as multithreading. Each thread can carry out independent tasks and has its own path of execution. Parallelism can be made possible with multithreading, and responsiveness and application speed can all be improved.
    - Thread creation: The operating system or the application itself often creates threads within a process. For the purpose of creating and managing threads, the operating system offers system calls or APIs. POSIX threads (pthread) and Windows threads are two popular threading APIs.
    - Thread States: Throughout their lifespan, threads can be in a variety of states, including running, ready, blocked, and terminated. Based on the states and priorities of the threads, the operating system scheduler chooses how much CPU time to give each of them.
    - Thread synchronization: To prevent conflicts and guarantee data consistency, threads inside a process may need to coordinate their activity. To coordinate access to shared resources, synchronization methods including locks, semaphores, mutexes, and condition variables are utilized.
    - Thread Communication: Through shared memory, message passing, or other interprocess communication (IPC) protocols, threads within a process can talk to one another and share data. In order to avoid data races and guarantee the integrity of shared data, proper synchronization is necessary.
    - Thread Context Switching: The operating system uses thread context switching to change the threads that are currently being executed. Context switching entails preserving the context of the currently running thread and loading the context of the upcoming thread. This enables multitasking and the effective use of system resources.
    - Thread Priorities: Each thread may have a distinct priority, which determines how important it is to it and how much CPU time it gets. While lower priority threads may have longer wait times, higher priority threads are scheduled more frequently.
    - Thread Pooling: A certain number of threads are established in advance and reused to carry out different tasks using the thread pooling approach. Through the reduction of thread creation and destruction costs, this method enhances performance under conditions when task execution is frequent.

In a variety of scenarios, such as software development, performance optimization, and virus investigation, thread analysis is crucial. Understanding the threads that malicious software uses can help with malware investigation by revealing information about its behavior, concurrency patterns, and potential effects on system resources.

Debuggers, profiling tools, and thread monitors are a few examples of tools that can help with thread analysis and monitoring. They can observe thread execution, keep tabs on interactions between threads, and detect suspicious or malicious threads.

# Handles

When discussing handles in the context of operating systems, it's important to note that they refer to special identification codes used to access system resources like files, registry keys, network connections, or hardware. Instead of directly referencing and controlling system resources by their physical or logical addresses, processes can do so via using handles.

Here are some crucial ideas regarding handles:

    - Resource Access: Handles are used to get access to and control over system resources. A file handle, for instance, enables a process to open, read, and close files. The ability to send and receive data across a network connection is similar to that of a handle to a network socket.
    -Handle Types: Depending on the kind of resource they represent, handles come in a variety of shapes and sizes. File handles, process handles, thread handles, event handles, mutex handles, and registry handles are a few examples of common handle types.
    - Unique Identifiers: Handles are distinctive identifiers that the operating system assigns to resources in the system. Processes don't need to know the particular locations or internal information of these resources in order to reference and interact with them via handles.
    - Handle Table: The operating system keeps a handle table that links handles to the appropriate resources. Using this table, the operating system can monitor and control resource utilization, enforce security permissions, and carry out actions on the process's behalf.
    - Handle Leaks: This occur when a process continuously produces handles without properly shutting or releasing them. This improper management of handles can cause handle leaks. Resource depletion, lowered system performance, or even system instability can be caused by handle leaks.
    - Handle Inheritance: In some circumstances, child processes made by a parent process may inherit handles. As a result, child processes can use the same resources as their parent processes to access and modify them.
    - Handle Enumeration: Process monitoring and virus analysis frequently entail counting the handles that a process uses. Insights about the resources accessible, such as open files, network connections, and synchronization objects, can be gained from this.

In the context of malware investigation, analyzing handles might assist in spotting questionable or malicious activity. Malware can employ handles to carry out operations including file modification, network connectivity, and process code injection. Monitoring and examining the handles that processes utilize can reveal important details about the resources accessed and the malware's possible effects.

Analyzing and monitoring handles can be aided by a number of tools and approaches, such as handle monitors, system analyzers, or debugging tools.
